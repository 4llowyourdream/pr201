Подгружаем пакет для метода максимального правдоподобия:
```{r, message=FALSE}
library("maxLik")
```


Задача 1. Взяв несколько пачек m&m-син исследователь Вениамин посчитал количества эмэндэмсин разных цветов. 
```{r}
x <- c(25, 35, 30, 32, 27, 31)
```

Вениамин хочет проверить гипотезу $H_0$: все цвета встречаются равновероятно, с вероятностью $1/6$.

Решение. 

Задаём функцию правдподобия для данного случая:
\[
L(p)=p_1^{x_1}\cdot p_2^{x_2}\cdot \ldots \cdot p_6^{x_6}
\]

Логарифмируем, получаем $\ell(p)=\sum_{i=1}^{6} x_i \ln(p_i)$.

```{r}
ell <- function(p) {
  ans <- sum(x*log(p))
  return(ans)
}
```

В данной задаче можно руками без компа найти максимум правдоподобия :)

```{r}
p_ml <- x/180
p_ml
p_h0 <- rep(1/6, 6)
p_h0
```

Значения правдоподобия в точке экстремума и в точке, соответствующей верной $H_0$:

```{r}
ell(p_ml)
ell(p_h0)
```

Считаем статистику отношения правдоподобия и находим критическое значение
```{r}
LR <- 2*(ell(p_ml)-ell(p_h0))
LR
qchisq(0.95, df=5)
```

Вывод: $H_0$ не отвергается

Если максимизировать в R, то надо явно выделить пять независимых вероятностей и создать отдельную функцию:
```{r}
ell2 <- function(p5) {
  last_pro <- 1-sum(p5)
  all_p <- c(p5, last_pro)
  ans <- ell(all_p)
  return(ans)
}
```

Находим оценки с помощью R:
```{r}
model <- maxLik(logLik = ell2, start = rep(1/6,5))
model$estimate
```


Задача 2. 

Величины $X_1$, $X_2$, \ldots, $X_{100}$ независимы и нормальны $N(\mu, \sigma^2)$. Для имеющейся выборки оказалось, что $\sum X_i=200$, $\sum X_i^2=1100$. 

Найдите ML оценки $\mu$, $\sigma^2$.

Проверьте гипотезу $H_0$: $\mu=3$ и $\sigma^2=10$

Задаем функцию правдоподобия
```{r}
ell <- function(pars) {
  mu <- pars[1]
  s2 <- pars[2]
  ans <- -50*log(s2)-
    (1100+100*mu^2-2*200*mu)/(2*s2)
  return(ans)
}
```

Для наглядности значения лог-правдоподобия в нескольких точках
```{r}
ell(c(1,1))
ell(c(2,7))
ell(c(100,100))
```


Максимизируем функцию правдоподобия в R:
```{r}
model <- maxLik(logLik = ell, start=c(0,1))
pars_ml <- model$estimate
pars_ml
```

Заводим вектор для $H_0$:
```{r}
pars_h0 <- c(3,10)
pars_h0
```



LR-статистика и критические значения
```{r}
LR <- 2*(ell(pars_ml)-ell(pars_h0))
LR
qchisq(0.95, df=2)
```

Вывод: $H_0$ отвергается



